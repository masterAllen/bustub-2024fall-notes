```
ä½†ä¸ºä»€ä¹ˆæˆ‘åœ¨ InsertExecutor ä¸­çš„ Next æ–¹æ³•ä¸­æ‰§è¡Œäº† GetTableIndexesï¼Œè¿”å›çš„æ˜¯ç©ºï¼ŸæŒ‰ç†æ¥è¯´è¿™å¼ è¡¨åº”è¯¥å­˜åœ¨ï¼Œæˆ‘æ‰èƒ½æ’å…¥å§ï¼Ÿå¯æ˜¯ç°åœ¨æ˜¾ç¤ºè¿™å¼ è¡¨å„ä¸ªæ¡ç›®çš„ç´¢å¼•æ˜¯ç©ºçš„ï¼Ÿ
```

ä½ æåˆ°åœ¨ `InsertExecutor::Next()` ä¸­è°ƒç”¨ `GetTableIndexes()` è¿”å›ç©ºï¼Œè¿™åœ¨ BusTub é‡Œæ˜¯å¸¸è§çš„â€œæ–°æ‰‹å‘â€ä¹‹ä¸€ã€‚åˆ«æ€¥ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ‹†è§£åŸå› ï¼š

---

## âœ… ä½ è¯´å¾—æ²¡é”™ï¼š

* è¡¨ **ç¡®å®å­˜åœ¨**ï¼Œä½ æ‰ä¼šåœ¨æ‰§è¡Œå™¨ä¸­æ’å…¥æ•°æ®ï¼›
* ä½†ã€Œè¡¨å­˜åœ¨ã€â‰ ã€Œè¡¨æœ‰ç´¢å¼•ã€ã€‚

---

## ğŸ’¡ é¦–å…ˆç¡®è®¤ï¼šä½ æœ‰æ²¡æœ‰ä¸ºè¿™å¼ è¡¨åˆ›å»ºç´¢å¼•ï¼Ÿ

åœ¨ BusTub ä¸­ï¼š

```sql
CREATE TABLE student(id INT, name VARCHAR);
```

å¹¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºä»»ä½•ç´¢å¼•ã€‚

è€Œä½ è¦æ˜¾å¼æ‰§è¡Œï¼š

```sql
CREATE INDEX id_index ON student(id);
```

è¿™æ · `Catalog::table_indexes_["student"]` æ‰ä¼šè¢«å¡«ä¸Šã€‚

æ‰€ä»¥æœ€å¸¸è§çš„æƒ…å†µå°±æ˜¯ï¼š

> âœ… ä½ åˆ›å»ºäº†è¡¨ï¼Œä½† âŒ æ²¡æœ‰ä¸ºå®ƒå»ºç´¢å¼•ã€‚

æ­¤æ—¶åœ¨æ‰§è¡Œ `GetTableIndexes("student")` å°±ä¼šè¿”å›ä¸€ä¸ªç©ºçš„ `vector<IndexInfo *>`ï¼Œè¿™æ˜¯**å®Œå…¨åˆæ³•å’Œé¢„æœŸçš„è¡Œä¸º**ã€‚

---

## ğŸ” æ›´æ·±å…¥åœ°æ’æŸ¥

### âœ… ä½ å¯ä»¥åœ¨ InsertExecutor ä¸­ä¸´æ—¶æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼š

```cpp
auto indexes = exec_ctx_->GetCatalog()->GetTableIndexes(table_info_->name_);
std::cout << "Index count for table " << table_info_->name_ << ": " << indexes.size() << std::endl;
```

å¦‚æœæ˜¯ 0ï¼Œè¯´æ˜ç¡®å®æ²¡æœ‰ä¸ºè¯¥è¡¨æ³¨å†Œè¿‡ç´¢å¼•ã€‚

---

## ğŸ“Œ é‚£ç´¢å¼•æ˜¯åœ¨å“ªé‡Œæ³¨å†Œçš„ï¼Ÿ

ç´¢å¼•çš„åˆ›å»ºé€šå¸¸å‘ç”Ÿåœ¨ï¼š

* **`Planner` é˜¶æ®µåç”±æ‰§è¡Œå™¨æ‰§è¡Œ `CreateIndexStatement`**
* æˆ–è€…ä½ å†™å•å…ƒæµ‹è¯•æ—¶æ‰‹åŠ¨åœ¨ `Catalog` ä¸­è°ƒç”¨ `CreateIndex()` æ³¨å†Œè¿›å»

æ¯”å¦‚ï¼š

```cpp
catalog->CreateIndex<GenericKey<8>, RID, GenericComparator<8>>(
    txn, "id_index", table_name, schema, key_attrs, buffer_pool_manager);
```

è¿™æ‰ä¼šå†™å…¥ `table_indexes_`ã€‚

---

## ğŸ§ª å¦‚ä½•éªŒè¯å¹¶å¤ç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

ä½ å¯ä»¥ç”¨ä¸€æ®µæœ€å°ä»£ç åšéªŒè¯ï¼ˆä»¥ test æ¡†æ¶ä¸ºä¾‹ï¼‰ï¼š

```cpp
// åˆ›å»ºè¡¨
auto table_schema = MakeSchema({"id", "name"});
catalog->CreateTable(txn, "student", table_schema);

// æ­¤æ—¶ï¼šæ²¡æœ‰ç´¢å¼•
auto indexes = catalog->GetTableIndexes("student");
assert(indexes.size() == 0); // âœ… æ­£ç¡®è¡Œä¸º

// åˆ›å»ºç´¢å¼•
std::vector<uint32_t> key_attrs{0}; // å¯¹ id å»ºç´¢å¼•
catalog->CreateIndex<GenericKey<8>, RID, GenericComparator<8>>(
    txn, "id_index", "student", table_schema, key_attrs, buffer_pool_manager);

// å†æ¬¡è·å–ç´¢å¼•
auto indexes_after = catalog->GetTableIndexes("student");
assert(indexes_after.size() == 1); // âœ… æœ‰äº†
```

---

## âœ… æ€»ç»“

| å¯èƒ½åŸå›                            | è¯´æ˜                                                   |
| ------------------------------ | ---------------------------------------------------- |
| âœ… æ²¡æœ‰æ‰§è¡Œ `CREATE INDEX`          | è¡¨å­˜åœ¨ä¸ç­‰äºæœ‰ç´¢å¼•ï¼Œè¿™æ˜¯æœ€å¸¸è§åŸå›                                     |
| ğŸ” è¡¨åæ‹¼å†™é”™è¯¯                      | ä¹Ÿå¯èƒ½æ˜¯ä½ æ‹¿åˆ°çš„ `table_name` ä¸ `table_indexes_` é‡Œå­˜çš„ key ä¸ä¸€è‡´ |
| âŒ æ’å…¥çš„æ•°æ®ä¸æ˜¯æ¥è‡ª SQL æ‰§è¡Œè·¯å¾„ï¼Œè€Œæ˜¯ä½ æ‰‹åŠ¨å†™çš„æµ‹è¯• | å¦‚æœç»•è¿‡äº†è¯­æ³•/æ‰§è¡Œå™¨æµç¨‹ï¼Œç´¢å¼•ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆ                               |

---

éœ€è¦çš„è¯æˆ‘å¯ä»¥å¸®ä½ çœ‹å…·ä½“çš„ `InsertExecutor` å’Œ `Catalog` è°ƒç”¨å †æ ˆï¼Œåˆ¤æ–­æ˜¯å“ªä¸€å—é€»è¾‘å¯¼è‡´ç´¢å¼•æ²¡åˆ›å»ºã€‚ä½ ä¹Ÿå¯ä»¥è´´ä¸Šç›¸å…³å»ºè¡¨å’Œæ’å…¥è¯­å¥æˆ–æµ‹è¯•ä»£ç ç‰‡æ®µã€‚


```
create table t2(v1 int, v2 varchar(128), v3 int); è¿™å¥æ‰§è¡Œå®Œä¹‹åä¼šæœ‰ç´¢å¼•å—
```

ä¸ä¼šã€‚âœ…

æ‰§è¡Œå¦‚ä¸‹ SQLï¼š

```sql
CREATE TABLE t2(v1 INT, v2 VARCHAR(128), v3 INT);
```

**å¹¶ä¸ä¼šè‡ªåŠ¨ä¸º `t2` åˆ›å»ºä»»ä½•ç´¢å¼•**ï¼Œå“ªæ€• `v1` çœ‹èµ·æ¥åƒä¸»é”®ä¹Ÿä¸ä¼šã€‚é™¤éä½ æ˜¾å¼å†™ `PRIMARY KEY` æˆ–æ‰‹åŠ¨ `CREATE INDEX`ã€‚

---

## ğŸ“Œ ä½ åˆ›å»ºè¿™å¼ è¡¨ä¹‹åï¼ŒCatalog ä¸­çš„çŠ¶æ€ï¼š

* `Catalog::table_names_` ä¸­ä¼šæœ‰ä¸€é¡¹ï¼š`"t2"`ï¼›
* `Catalog::tables_["t2"]` å¯¹åº”çš„ `TableInfo` ä¼šè¢«åˆ›å»ºï¼›
* `Catalog::table_indexes_["t2"]` ä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„ vectorï¼Œæˆ–æ ¹æœ¬æ²¡æœ‰æ¡ç›®ï¼ˆå®ç°ç»†èŠ‚ä¸åŒç‰ˆæœ¬ç•¥æœ‰å·®å¼‚ï¼‰ï¼›
* æ‰€ä»¥ `GetTableIndexes("t2")` è¿”å›çš„æ˜¯ `0` ä¸ªç´¢å¼•ã€‚

---

## ğŸ§  æƒ³è®© `t2` æœ‰ç´¢å¼•ï¼Œå¿…é¡»è¿™ä¹ˆå†™ï¼š

```sql
CREATE INDEX v1_index ON t2(v1);
-- æˆ–è€…
CREATE UNIQUE INDEX v1_index ON t2(v1);
-- æˆ–è€…
CREATE TABLE t2(v1 INT PRIMARY KEY, ...);  -- æœ‰äº›æ•°æ®åº“ä¼šè‡ªåŠ¨å»ºä¸»é”®ç´¢å¼•ï¼ˆBusTub ä¸ä¸€å®šï¼‰
```

åªæœ‰è¿™æ ·ï¼Œæ‰§è¡Œå™¨æ‰ä¼šæŠŠç´¢å¼•ç»“æ„æ³¨å†Œè¿› `Catalog::table_indexes_`ï¼Œæ’å…¥æ—¶æ‰ä¼šèµ°æ›´æ–°ç´¢å¼•é€»è¾‘ã€‚

---

## âœ… æ€»ç»“ä¸€å¥è¯

> `CREATE TABLE t2(...)` æœ¬èº« **ä¸ä¼šåˆ›å»ºä»»ä½•ç´¢å¼•**ï¼Œä¹Ÿä¸ä¼šå½±å“ `InsertExecutor` æ˜¯å¦éœ€è¦æ›´æ–°ç´¢å¼•ã€‚ä½ åªæœ‰åœ¨æ˜¾å¼åˆ›å»ºç´¢å¼•åï¼Œ`GetTableIndexes("t2")` æ‰ä¼šè¿”å›éç©ºã€‚

å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥ç»™ä½ å†™ä¸ª BusTub æµ‹è¯•ä»£ç ç‰‡æ®µï¼Œåˆ›å»ºè¡¨ + åˆ›å»ºç´¢å¼• + æ’å…¥æ•°æ® + éªŒè¯ç´¢å¼•æ˜¯å¦æ›´æ–°ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ